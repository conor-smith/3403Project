<!DOCTYPE html>
<html lang = "en">
  <head>
    <meta charset = "UTF-8">
    {% if title %}
      <title>{{ title }}</title>
    {% else %}
      <title>Polls</title>
    {% endif %}
    <!-- Bootstrap related -->
    <meta name = "viewport" content = "width=device-width, initial-scale=1">
    <link rel = "stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src = "https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <!-- End of Bootstrap related-->
    <link rel = "stylesheet"
    type = "text/css"
    href = "{{ url_for('static', filename='css/global.css') }}"> <!-- css file -->
    <script src = "{{ url_for('static', filename='javascript/global.js')}}"></script> <!-- javascript file -->
  </head>

  <body>
    <!-- NAVBAR -->
    <nav class = "navbar navbar-expand-sm">
      <a class = "navbar-brand" href="{{ url_for('front') }}">
        <img src = "http://placehold.it/150x50?text=Logo" alt="Logo">
      </a> <!-- TODO add logo img -->
      
      <!-- Left side navbar elements -->
      <ul class = "navbar-nav mr-auto">
        <li class = "nav-item">
          <a class = "nav-link" href="#">Show Polls</a> <!-- TODO make this page -->
        </li>
        <li class = "nav-item">
          <a class = "nav-link" href="#">Archives</a> <!-- TODO make this page -->
        </li>
        {% if current_user and not current_user.is_anonymous and current_user.admin %}
          <li class = "nav-item dropdown">
            <a class = "nav-link dropdown-toggle" href = "#" id = "navbardrop" data-toggle = "dropdown">
              Admin Tools
            </a>

            <div class = "dropdown-menu">
              <a class = "dropdown-item" href="{{url_for('create_polls')}}">Create Polls</a> <!-- Admin only -->
              <a class = "dropdown-item" href="{{url_for('admin.index')}}">User Details</a> <!-- Admin only -->
              <a class = "dropdown-item" href="{{url_for('modify_admins')}}">Modify Admins</a> <!-- Super admin only -->
            </div>
          </li>
        {% endif %}
      </ul>

      <!-- Right side navbar elements -->
      {% if current_user and not current_user.is_anonymous %}
        <ul class = "navbar-nav ml-auto">
          <li class = "nav-item">
            <p class = "nav-link" id="userlogin">Welcome {{ current_user.username }}</a>
          </li>
          <li class = "nav-item">
            <a class = nav-link href = "{{ url_for('logout') }}">Log out</a>
          </li>
        </ul>
      {% else %}
        <ul class = "navbar-nav ml-auto">
          <li class = "nav-item">
            <a class = "nav-link" href="#" data-toggle="modal" data-target="#login">Log in</a>
          </li>
          <li class = "nav-item">
            <a class = "nav-link" href="{{url_for('register')}}">Register</a>
          </li>
        </ul>
      {% endif %}
    </nav>

    {% if current_user.is_anonymous %}
    <!-- Log In Modal -->
    <div id="login" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title">Log In</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
          </div>

          <div class="modal-body" id="renderLogin"></div>
          <script>window.onload = renderLogin()</script>

          <div class="modal-footer">
            <p>
              Don't have an account? <a href="{{url_for('register')}}">Sign Up</a>
            </p>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

    {% with messages = get_flashed_messages() %}
    {% if messages %}
    <ul class="alert alert-primary" role="alert">
        {% for message in messages %}
        <li>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}

    <!-- FOOTER -->
    <footer>
      <span id = "lastmod"></span><script>window.onload = lastModified();</script>
    </footer>
  </body>
</html>